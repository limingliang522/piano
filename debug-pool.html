<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>å¯¹è±¡æ± è°ƒè¯•é¢æ¿</title>
    <style>
        body {
            font-family: monospace;
            background: #1a1a1a;
            color: #00ff00;
            padding: 20px;
        }
        .panel {
            background: #000;
            border: 2px solid #00ff00;
            padding: 20px;
            margin: 10px 0;
            border-radius: 8px;
        }
        .stat {
            margin: 5px 0;
            font-size: 16px;
        }
        .warning {
            color: #ff9900;
        }
        .error {
            color: #ff0000;
        }
        button {
            background: #00ff00;
            color: #000;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            cursor: pointer;
            font-family: monospace;
            font-size: 14px;
            border-radius: 4px;
        }
        button:hover {
            background: #00cc00;
        }
    </style>
</head>
<body>
    <h1>ğŸ± é»‘å—å¯¹è±¡æ± è°ƒè¯•é¢æ¿</h1>
    
    <div class="panel">
        <h2>å¯¹è±¡æ± çŠ¶æ€</h2>
        <div class="stat">æ¿€æ´»é»‘å—: <span id="active">0</span></div>
        <div class="stat">æ™®é€šé»‘å—æ± : <span id="normal">0</span></div>
        <div class="stat">è¶…é«˜é»‘å—æ± : <span id="tall">0</span></div>
        <div class="stat">noteObjectsæ•°ç»„: <span id="noteObjects">0</span></div>
        <div class="stat">æ€»é»‘å—æ•°: <span id="total">0</span></div>
    </div>
    
    <div class="panel">
        <h2>æ€§èƒ½æŒ‡æ ‡</h2>
        <div class="stat">åˆ›å»ºæ¬¡æ•°: <span id="createCount">0</span></div>
        <div class="stat">å›æ”¶æ¬¡æ•°: <span id="recycleCount">0</span></div>
        <div class="stat">æ± è€—å°½æ¬¡æ•°: <span id="emptyCount">0</span></div>
    </div>
    
    <div class="panel">
        <h2>æ§åˆ¶</h2>
        <button onclick="refreshStats()">åˆ·æ–°ç»Ÿè®¡</button>
        <button onclick="logPoolState()">è¾“å‡ºè¯¦ç»†æ—¥å¿—</button>
        <button onclick="testPool()">æµ‹è¯•å¯¹è±¡æ± </button>
    </div>
    
    <div class="panel">
        <h2>æ—¥å¿—</h2>
        <div id="log" style="max-height: 300px; overflow-y: auto;"></div>
    </div>
    
    <script>
        // åœ¨æ§åˆ¶å°æ·»åŠ è¿™äº›å‡½æ•°åˆ°å…¨å±€
        window.debugPool = {
            createCount: 0,
            recycleCount: 0,
            emptyCount: 0
        };
        
        function refreshStats() {
            if (typeof blockPool === 'undefined') {
                addLog('âŒ blockPool æœªå®šä¹‰ï¼Œè¯·å…ˆå¯åŠ¨æ¸¸æˆ', 'error');
                return;
            }
            
            document.getElementById('active').textContent = blockPool.active.length;
            document.getElementById('normal').textContent = blockPool.normal.length;
            document.getElementById('tall').textContent = blockPool.tall.length;
            document.getElementById('noteObjects').textContent = noteObjects.length;
            
            const total = blockPool.active.length + blockPool.normal.length + blockPool.tall.length;
            document.getElementById('total').textContent = total;
            
            document.getElementById('createCount').textContent = window.debugPool.createCount;
            document.getElementById('recycleCount').textContent = window.debugPool.recycleCount;
            document.getElementById('emptyCount').textContent = window.debugPool.emptyCount;
            
            // æ£€æŸ¥å¼‚å¸¸
            if (blockPool.normal.length === 0 && blockPool.tall.length === 0 && blockPool.active.length < noteObjects.length) {
                addLog('âš ï¸ è­¦å‘Šï¼šå¯¹è±¡æ± å·²ç©ºä½†è¿˜æœ‰é»‘å—åœ¨ä½¿ç”¨ï¼', 'warning');
            }
            
            if (total < 500) {
                addLog(`âš ï¸ è­¦å‘Šï¼šæ€»é»‘å—æ•° ${total} å°‘äºé¢„æœŸçš„ 500`, 'warning');
            }
            
            addLog(`âœ… ç»Ÿè®¡å·²åˆ·æ–° - æ¿€æ´»:${blockPool.active.length} æ™®é€š:${blockPool.normal.length} è¶…é«˜:${blockPool.tall.length}`);
        }
        
        function logPoolState() {
            if (typeof blockPool === 'undefined') {
                addLog('âŒ blockPool æœªå®šä¹‰', 'error');
                return;
            }
            
            console.log('ğŸ± å¯¹è±¡æ± è¯¦ç»†çŠ¶æ€:');
            console.log('æ¿€æ´»é»‘å—:', blockPool.active);
            console.log('æ™®é€šé»‘å—æ± :', blockPool.normal);
            console.log('è¶…é«˜é»‘å—æ± :', blockPool.tall);
            console.log('noteObjects:', noteObjects);
            
            addLog('âœ… è¯¦ç»†æ—¥å¿—å·²è¾“å‡ºåˆ°æ§åˆ¶å°');
        }
        
        function testPool() {
            if (typeof blockPool === 'undefined') {
                addLog('âŒ blockPool æœªå®šä¹‰', 'error');
                return;
            }
            
            addLog('ğŸ§ª å¼€å§‹æµ‹è¯•å¯¹è±¡æ± ...');
            
            // æµ‹è¯•1ï¼šæ£€æŸ¥æ± çš„å®Œæ•´æ€§
            const total = blockPool.active.length + blockPool.normal.length + blockPool.tall.length;
            addLog(`æµ‹è¯•1: æ€»é»‘å—æ•° = ${total} (é¢„æœŸ: 500)`);
            
            // æµ‹è¯•2ï¼šæ£€æŸ¥æ˜¯å¦æœ‰é‡å¤
            const allBlocks = [...blockPool.active, ...blockPool.normal, ...blockPool.tall];
            const uniqueBlocks = new Set(allBlocks);
            if (allBlocks.length !== uniqueBlocks.size) {
                addLog(`âŒ æµ‹è¯•2å¤±è´¥: å‘ç°é‡å¤çš„é»‘å—ï¼`, 'error');
            } else {
                addLog(`âœ… æµ‹è¯•2é€šè¿‡: æ²¡æœ‰é‡å¤çš„é»‘å—`);
            }
            
            // æµ‹è¯•3ï¼šæ£€æŸ¥æ¿€æ´»åˆ—è¡¨å’ŒnoteObjectsæ˜¯å¦ä¸€è‡´
            if (blockPool.active.length !== noteObjects.length) {
                addLog(`âš ï¸ æµ‹è¯•3è­¦å‘Š: active(${blockPool.active.length}) != noteObjects(${noteObjects.length})`, 'warning');
            } else {
                addLog(`âœ… æµ‹è¯•3é€šè¿‡: æ¿€æ´»åˆ—è¡¨å’ŒnoteObjectsä¸€è‡´`);
            }
            
            addLog('ğŸ§ª æµ‹è¯•å®Œæˆ');
        }
        
        function addLog(message, type = 'info') {
            const log = document.getElementById('log');
            const time = new Date().toLocaleTimeString();
            const div = document.createElement('div');
            div.className = type;
            div.textContent = `[${time}] ${message}`;
            log.insertBefore(div, log.firstChild);
            
            // é™åˆ¶æ—¥å¿—æ•°é‡
            while (log.children.length > 50) {
                log.removeChild(log.lastChild);
            }
        }
        
        // è‡ªåŠ¨åˆ·æ–°
        setInterval(refreshStats, 1000);
        
        // åˆå§‹åˆ·æ–°
        setTimeout(refreshStats, 500);
        
        addLog('ğŸ± è°ƒè¯•é¢æ¿å·²å¯åŠ¨');
        addLog('ğŸ’¡ æç¤ºï¼šåœ¨æ¸¸æˆé¡µé¢æ‰“å¼€æ­¤é¡µé¢ï¼Œå¯ä»¥å®æ—¶ç›‘æ§å¯¹è±¡æ± çŠ¶æ€');
    </script>
</body>
</html>
