# 🎹 地铁跑酷 3D - MIDI 音乐节奏游戏

一款基于 Three.js 的 3D 音乐节奏游戏，玩家需要根据 MIDI 音乐节奏躲避黑块、收集道具，体验沉浸式的音乐游戏体验。

## 🎮 游戏特色

- **MIDI 音乐驱动**：游戏节奏完全由 MIDI 文件控制，每首歌曲都有独特的挑战
- **真实钢琴音色**：使用 FluidR3 GM 钢琴音色库，52 个音符采样，模拟施坦威 D 型钢琴音色
- **3D 空间音频**：支持 HRTF 3D 音频定位，根据轨道位置呈现立体声效果
- **动态画质调整**：自动检测设备性能，支持 low/medium/high/ultra 四档画质
- **云端数据同步**：基于 Supabase 的用户系统，支持成绩、设置、道具云端同步
- **音乐解锁系统**：通过收集拼图碎片解锁新音乐

## 🕹️ 操作方式

| 操作 | 键盘 | 触屏 |
|------|------|------|
| 左移 | ← / A | 左滑 |
| 右移 | → / D | 右滑 |
| 跳跃 | 空格 / ↑ | 点击 |

## 📁 项目结构

```
├── index.html              # 主页面（UI 布局、样式）
├── game.js                 # 游戏核心逻辑（场景、玩家、碰撞检测）
├── audio-engine.js         # 音频引擎（钢琴音色、3D 音频、音效）
├── midi-parser.js          # MIDI 文件解析器
├── render-system.js        # 渲染系统（性能监控、画质适配、后处理）
├── item-system.js          # 道具系统（果实、拼图碎片、血量）
├── music-unlock-system.js  # 音乐解锁系统
├── auth-system.js          # 用户认证系统
├── cloud-sync.js           # 云端数据同步
├── supabase-config.js      # Supabase 配置和 API
├── midi/                   # MIDI 音乐文件
│   ├── 1.mid, 1.mp3
│   ├── 2.mid, 2.mp3
│   └── ...
└── piano-samples/          # 钢琴音色采样（A0-C8）
```

## 🎵 核心模块说明

### 游戏引擎 (game.js)
- Three.js 3D 场景渲染
- 5 轨道跑酷玩法
- MIDI 音符转换为黑块障碍物
- 跳跃物理系统（重力、最大跳跃高度）
- 速度递增机制

### 音频引擎 (audio-engine.js)
- Web Audio API 实现
- 施坦威 D 型钢琴音色模拟
- 多段压缩器 + 卡内基音乐厅混响
- 背景音乐播放（MP3）
- 碰撞音效

### 渲染系统 (render-system.js)
- 性能监控器（FPS、内存）
- 画质适配器（自动/手动调整）
- 视锥剔除、LOD 管理
- 后处理效果（Bloom、SSAO）
- 对象池优化

### 道具系统 (item-system.js)
- 白色果实：+20 血量，+50 分
- 红色果实：-30 血量，-50 分
- 拼图碎片：+100 分，用于解锁音乐

## 🔧 技术栈

- **渲染引擎**：Three.js
- **音频处理**：Web Audio API
- **后端服务**：Supabase（认证、数据库）
- **音乐格式**：MIDI + MP3

## 🚀 快速开始

1. 使用本地服务器运行项目（需要 HTTP 服务器加载音频文件）
2. 打开浏览器访问 `index.html`
3. 点击开始按钮，等待资源加载
4. 选择音乐，开始游戏！

## 📱 设备支持

- 桌面浏览器（Chrome、Firefox、Edge、Safari）
- 移动设备（iOS Safari、Android Chrome）
- 自动适配屏幕尺寸和设备性能

## 🎯 游戏目标

- 躲避黑块障碍物（超高黑块需要跳跃）
- 触发音符获得分数
- 收集白色果实恢复血量
- 避开红色果实
- 收集拼图碎片解锁新音乐
- 挑战更高分数！
