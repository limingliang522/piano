# 完整测试清单

## ✅ 音频同步功能测试

### 1. 基础播放测试
- [ ] 游戏启动后，音频立即开始播放
- [ ] 第一个黑块到达触发线时，音频正好播放到第一个音符
- [ ] 音频音质清晰，无失真
- [ ] 音量适中，与原始 MP3 文件一致

### 2. 速度同步测试
- [ ] 完成第一轮后，速度提升到 1.25x
- [ ] 音频播放速度同步提升到 1.25x
- [ ] 黑块移动速度与音频速度保持一致
- [ ] 继续完成更多轮次，速度持续增加

### 3. 灵动岛暂停测试
- [ ] 点击灵动岛展开时，游戏暂停
- [ ] 展开时，背景音乐同步暂停
- [ ] 点击收起灵动岛时，游戏恢复
- [ ] 收起时，背景音乐从暂停位置恢复播放
- [ ] 音频速度保持不变

### 4. 游戏结束暂停测试
- [ ] 碰撞黑块时，游戏结束
- [ ] 游戏结束时，背景音乐立即暂停
- [ ] 点击"继续游戏"，音频从暂停位置恢复
- [ ] 音频速度保持不变

### 5. 重新开始测试
- [ ] 点击"重新开始"，游戏重置
- [ ] 音频从第一个黑块时间点重新播放
- [ ] 速度重置为 1.0x
- [ ] 黑块和音频重新同步

### 6. 切换歌曲测试
- [ ] 展开灵动岛，显示歌曲列表
- [ ] 点击其他歌曲，当前音频停止
- [ ] 新歌曲加载完成，显示播放按钮
- [ ] 点击播放按钮，新歌曲开始播放
- [ ] 新歌曲的第一个黑块与音频同步

### 7. 完成一轮测试
- [ ] 触发所有黑块，完成一轮
- [ ] 自动进入下一轮
- [ ] 音频从第一个黑块时间点重新播放
- [ ] 播放速度为新的速度倍数（1.25x, 1.56x, ...）

## 🎯 控制台日志检查

### 游戏启动时应显示：
```
🎵 第一个音符时间: X.XX秒
📏 黑块到触发线距离: X.XX
⏱️ 移动到触发线需要: X.XX秒
🎵 音频从 X.XX秒 开始播放
🎵 背景音乐开始播放，速度: 1.00x
🎮 游戏启动！方块数量: XXX
```

### 展开灵动岛时应显示：
```
🎵 灵动岛展开，暂停音频播放
⏸️ 背景音乐暂停在 X.XX秒
```

### 收起灵动岛时应显示：
```
🎵 灵动岛收起，恢复音频播放
```

### 完成一轮时应显示：
```
🎵 新一轮：音频从 X.XX秒 开始，速度: X.XXx
第 X 轮开始！创建了 XXX 个音符方块
```

### 切换歌曲时应显示：
```
🔄 开始切换 MIDI 文件...
🎵 停止当前背景音乐
🧹 步骤1: 清理旧场景对象...
📥 步骤3: 加载新 MIDI 文件...
🎵 加载背景音乐: midi/X.mp3
✅ 背景音乐加载完成，时长: X.XX秒
```

## 🐛 常见问题排查

### 问题：音频没有播放
**检查项**：
- [ ] `midi/1.mp3` 文件是否存在
- [ ] 浏览器控制台是否有错误
- [ ] 音频上下文是否已启动
- [ ] 检查 `audioEngine.bgmBuffer` 是否已加载

**解决方法**：
```javascript
// 在控制台输入
console.log(audioEngine.bgmBuffer); // 应该显示 AudioBuffer 对象
console.log(audioEngine.audioContext.state); // 应该是 "running"
```

### 问题：音频与黑块不同步
**检查项**：
- [ ] 第一个音符时间是否正确
- [ ] 移动时间计算是否正确
- [ ] 播放速度是否正确应用

**解决方法**：
```javascript
// 在控制台输入
console.log('第一个音符时间:', midiNotes[0].time);
console.log('当前速度倍数:', speedMultiplier);
console.log('音频播放速度:', audioEngine.bgmPlaybackRate);
```

### 问题：展开灵动岛后音频没有暂停
**检查项**：
- [ ] `toggleIsland()` 函数是否被调用
- [ ] `audioEngine.pauseBGM()` 是否被执行
- [ ] 控制台是否显示暂停日志

**解决方法**：
```javascript
// 在控制台输入
console.log('音频是否播放:', audioEngine.bgmIsPlaying);
console.log('暂停时间:', audioEngine.bgmPauseTime);
```

### 问题：音频速度没有变化
**检查项**：
- [ ] 是否完成了至少一轮
- [ ] `speedMultiplier` 是否增加
- [ ] `setBGMPlaybackRate()` 是否被调用

**解决方法**：
```javascript
// 在控制台输入
console.log('速度倍数:', speedMultiplier);
console.log('获得星星:', starsEarned);
console.log('音频播放速度:', audioEngine.bgmSource?.playbackRate.value);
```

## 📊 性能指标

### 正常范围：
- **音频延迟**：< 50ms
- **CPU 使用率**：< 30%
- **内存使用**：< 200MB
- **帧率**：≥ 60 FPS

### 监控方法：
```javascript
// 在控制台输入
console.log('FPS:', currentFPS);
console.log('活跃音符:', audioEngine.getActiveNoteCount());
console.log('场景物体:', scene.children.length);
console.log('音符方块:', noteObjects.length);
```

## ✨ 成功标准

所有测试项都通过 ✅，并且：
1. 音频从第一个黑块时间点开始播放
2. 音频速度随游戏速度实时变化
3. 暂停时音频同步暂停
4. 恢复时音频从暂停位置继续
5. 重新开始时音频重置
6. 完成一轮后音频以新速度重播
7. 展开灵动岛时音频暂停
8. 切换歌曲时音频正确停止和加载
9. 音质清晰，无失真
10. 音频与黑块完美同步
