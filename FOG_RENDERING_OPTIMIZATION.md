# 迷雾边缘渲染优化

## 功能说明

实现了一个性能优化功能：**黑块只有在移动到迷雾边缘（玩家视野范围内）时才会被渲染**。

## 实现原理

### 1. 延迟渲染机制

- **初始状态**：所有黑块创建后不立即添加到场景中
- **触发条件**：当黑块的 Z 坐标 >= 迷雾边缘 - 渲染距离时
- **渲染动作**：将黑块添加到场景并设置为可见

### 2. 关键参数

```javascript
const fogEdgeZ = -50;           // 迷雾边缘的Z坐标
const renderDistance = 10;      // 提前渲染距离
```

### 3. 代码修改

#### createNoteBlock() 函数
- 添加 `isRendered` 标记到 userData
- 初始设置 `visible = false`
- 不立即添加到场景（注释掉 `scene.add()`）

#### updateNoteBlocks() 函数
- 检查黑块是否到达渲染边界
- 首次进入视野时：
  - 设置 `isRendered = true`
  - 设置 `visible = true`
  - 添加到场景 `scene.add(noteBlock)`
  - 输出日志

## 性能优势

1. **减少渲染负担**：远处的黑块不参与渲染计算
2. **降低 Draw Call**：只渲染可见范围内的对象
3. **提升帧率**：特别是在黑块数量多的情况下
4. **节省 GPU 资源**：减少不必要的着色器计算

## 视觉效果

- 黑块从迷雾深处逐渐"浮现"
- 玩家只能看到视野范围内的黑块
- 保持游戏的神秘感和沉浸感

## 调试信息

在控制台中可以看到：
```
🎨 黑块进入视野: z=-40.23
```

## 可调整参数

- `fogEdgeZ`：调整迷雾边缘位置（越小越远）
- `renderDistance`：调整提前渲染距离（越大越早出现）

## 注意事项

- 确保 `renderDistance` 足够大，避免黑块突然"弹出"
- 配合场景雾效（`scene.fog`）使用效果更佳
- 黑块移除逻辑保持不变（超出屏幕后自动清理）
